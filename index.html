<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Yuki & Mokaの結婚式プロフィールブック。2026年4月11日、ホテル椿山荘東京にて。">
    <meta property="og:title" content="Wedding Profile Book | Yuki & Moka">
    <meta property="og:description" content="Yuki & Mokaの結婚式プロフィールブック">
    <meta property="og:type" content="website">
    <meta property="og:image" content="images/hero.jpg">
    <title>Wedding Profile Book | Yuki & Moka</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Shippori+Mincho:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- メニューボタン -->
    <button class="menu-btn" id="openMenuModal" aria-label="メニューを開く">
        <span aria-hidden="true">&equiv;</span>
    </button>

    <!-- ローディング表示 -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <p>Loading...</p>
    </div>

    <!-- ヒーローセクション -->
    <header class="hero container fade-in" id="top">
        <img src="images/hero.jpg" alt="結婚式のカップル写真" class="hero-img" loading="eager">
        <h1 class="hero-title">Yuki & Moka</h1>
        <p class="hero-date">2026.04.11 | Hotel Chinzanso Tokyo</p>
    </header>

    <!-- ご挨拶 -->
    <section class="container fade-in" id="greeting">
        <h2 class="section-title">Greeting</h2>
        <div class="greeting-text">
            <p>本日はご多用の中<br>私たちの結婚式にご参列いただき<br>誠にありがとうございます。</p>
            <p>皆様に支えられ<br>今日という日を迎えることができました。</p>
            <p>ささやかながら<br>感謝の気持ちを込めて<br>プロフィールブックを作成しました。</p>
            <p>どうぞごゆっくりお楽しみください。</p>
        </div>
    </section>

    <!-- プロフィール -->
    <section class="container fade-in" id="profile">
        <h2 class="section-title">Profile</h2>
        
        <div class="profile-card">
            <img src="images/profile/yuki.jpg" alt="新郎 Yuki Gotoのプロフィール写真" class="profile-img" loading="lazy">
            <h3 class="profile-name">Yuki Goto</h3>
            <p class="profile-desc">
                1998年生まれ、岡山県出身。<br>
                趣味は温泉に入ったり、ゆっくりすること。<br>
                休日はお家でだらだらと過ごしています。<br>
                一言：今日は最高の1日にしましょう！
            </p>
        </div>

        <div class="profile-card">
            <img src="images/profile/moka.jpg" alt="新婦 Moka Suzukiのプロフィール写真" class="profile-img" loading="lazy">
            <h3 class="profile-name">Moka Suzuki</h3>
            <p class="profile-desc">
                1999年生まれ、東京都出身。<br>
                趣味はライブに行くこと。<br>
                特技は新しいことに挑戦できること。<br>
                一言：たくさん写真を撮ってくださいね♪
            </p>
        </div>
    </section>
    
    <!-- 二人の物語 -->
    <section class="container fade-in" id="story">
        <h2 class="section-title">Our Story</h2>

        <div class="story-item">
            <div class="story-img-box">
                <img src="images/story/01.jpg" alt="初デート キャンプの思い出" loading="lazy">
            </div>
            <div class="story-content">
                <h4>2022.05.20 | First Date</h4>
                <p>初めて二人でキャンプに行った時の写真です。雨予報でしたが、奇跡的に晴れて最高の星空を見ることができました。ここから二人の関係が始まりました。</p>
            </div>
        </div>

        <div class="story-item">
            <div class="story-img-box">
                <img src="images/story/02.jpg" alt="プロポーズ 海辺での思い出" loading="lazy">
            </div>
            <div class="story-content">
                <h4>2023.11.15 | Proposal</h4>
                <p>モカの誕生日サプライズで旅行先の海辺でプロポーズしました。緊張しすぎて何を言ったか覚えていませんが、指輪を渡した瞬間、泣きながら「はい」と言ってくれた時は感動しました。</p>
            </div>
        </div>

        <div class="story-item">
            <div class="story-img-box">
                <img src="images/story/03.jpg" alt="同棲開始 新生活の思い出" loading="lazy">
            </div>
            <div class="story-content">
                <h4>2024.03.01 | Together</h4>
                <p>二人で暮らし始めた記念に撮った一枚。家具を選ぶのは大変でしたが、二人だけの空間ができて毎日が楽しくなりました。これからもたくさん笑い合って過ごしたいです。</p>
            </div>
        </div>
    </section>

    <!-- 前撮り写真 -->
    <section class="container fade-in" id="preshoot">
        <h2 class="section-title">Pre-shoot</h2>
        
        <div class="slideshow-container" id="slideshowPre" role="region" aria-label="前撮り写真スライドショー">
            <button class="prev-arrow" onclick="plusSlidesPre(-1)" aria-label="前の写真">&#10094;</button>
            <button class="next-arrow" onclick="plusSlidesPre(1)" aria-label="次の写真">&#10095;</button>
        </div>
        <div class="dots-container" id="dotsPreshoot" role="tablist" aria-label="写真ナビゲーション"></div>
    </section>

    <!-- 思い出の写真 -->
    <section class="container fade-in" id="memories">
        <h2 class="section-title">Memories</h2>
        
        <div class="slideshow-container" id="slideshow" role="region" aria-label="思い出の写真スライドショー">
            <button class="prev-arrow" onclick="plusSlides(-1)" aria-label="前の写真">&#10094;</button>
            <button class="next-arrow" onclick="plusSlides(1)" aria-label="次の写真">&#10095;</button>
        </div>
        <div class="dots-container" id="dotsMemories" role="tablist" aria-label="写真ナビゲーション"></div>
    </section>

    <!-- 席次表 -->
    <section class="container fade-in" id="seating-chart">
        <h2 class="section-title">Seating Chart</h2>
        <div class="seating-chart-area">
            <img src="https://via.placeholder.com/800x600?text=Seating+Chart+Example" alt="席次表" id="seatingChartImg" loading="lazy">
            <p>※画像をタップすると拡大表示されます。</p>
        </div>
    </section>
    
    <!-- 写真共有 -->
    <section class="container fade-in" id="share-photos">
        <h2 class="section-title">Share Photos</h2>
        <div class="share-text">
            <p>本日の思い出の写真を<br>ぜひこちらからシェアしてください。<br>グループごとにアルバムを用意しました。</p>
        </div>
        
        <div class="share-buttons">
            <a href="https://photos.app.goo.gl/xxxxxxxxxxxx" target="_blank" rel="noopener noreferrer" class="share-btn">
                <span>For Friends</span>
                <span class="jp-label">友人・同僚の方はこちら</span>
            </a>

            <a href="https://photos.app.goo.gl/yyyyyyyyyyyy" target="_blank" rel="noopener noreferrer" class="share-btn">
                <span>For Family</span>
                <span class="jp-label">親族の方はこちら</span>
            </a>

            <a href="https://photos.app.goo.gl/zzzzzzzzzzzz" target="_blank" rel="noopener noreferrer" class="share-btn">
                <span>All Guests</span>
                <span class="jp-label">その他の方はこちら</span>
            </a>
        </div>
    </section>

    <!-- フッター -->
    <footer>
        <p>Thank you for coming today.</p>
        <p>Yuki & Moka</p>
    </footer>

    <!-- メニューモーダル -->
    <div id="menuModal" class="modal" role="dialog" aria-labelledby="menuTitle" aria-modal="true">
        <div class="modal-content">
            <button class="close-btn" aria-label="メニューを閉じる">&times;</button>
            <h2 id="menuTitle" class="sr-only">メニュー</h2>
            <nav>
                <ul class="menu-list">
                    <li><a href="#top">TOP<span class="jp-nav">トップ</span></a></li>
                    <li><a href="#greeting">GREETING<span class="jp-nav">ごあいさつ</span></a></li>
                    <li><a href="#profile">PROFILE<span class="jp-nav">プロフィール</span></a></li>
                    <li><a href="#story">OUR STORY<span class="jp-nav">二人の物語</span></a></li>
                    <li><a href="#preshoot">PRE-SHOOT<span class="jp-nav">前撮り</span></a></li>
                    <li><a href="#memories">MEMORIES<span class="jp-nav">思い出の写真</span></a></li>
                    <li><a href="#seating-chart">SEATING CHART<span class="jp-nav">席次表</span></a></li>
                    <li><a href="#share-photos">SHARE PHOTOS<span class="jp-nav">写真の共有</span></a></li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- 画像拡大モーダル -->
    <div id="imgModal" class="modal" role="dialog" aria-label="画像拡大表示" aria-modal="true">
        <button class="close-btn" aria-label="閉じる">&times;</button>
        <div class="modal-content" id="imgModalContent">
            <img class="modal-img" id="expandedImg" alt="拡大画像">
        </div>
    </div>

    <script>
        // =====================================
        // 設定とユーティリティ
        // =====================================
        const CONFIG = {
            sliders: {
                memories: { folder: 'images/memories', count: 5 },
                preshoot: { folder: 'images/preshoot', count: 7 }
            },
            autoPlayInterval: 4000,
            swipeThreshold: 50,
            maxDetectCount: 50
        };

        // =====================================
        // 画像の自動検出（最適化版）
        // =====================================
        async function detectImageCount(folderPath, maxCount = CONFIG.maxDetectCount) {
            const results = await Promise.all(
                Array.from({ length: maxCount }, (_, i) => {
                    const fileName = `${String(i + 1).padStart(2, '0')}.jpg`;
                    const url = `${folderPath}/${fileName}`;
                    
                    return fetch(url, { method: 'HEAD' })
                        .then(response => response.ok)
                        .catch(() => false);
                })
            );
            
            const lastValidIndex = results.lastIndexOf(true);
            return lastValidIndex + 1;
        }

        // =====================================
        // スライダークラス
        // =====================================
        class Slider {
            constructor(containerId, dotsContainerId, slideClass, dotClass, folder, count) {
                this.containerId = containerId;
                this.dotsContainerId = dotsContainerId;
                this.slideClass = slideClass;
                this.dotClass = dotClass;
                this.folder = folder;
                this.count = count;
                this.currentIndex = 1;
                this.timer = null;
                this.touchStartX = 0;
                this.isTransitioning = false;
            }

            build() {
                const container = document.getElementById(this.containerId);
                const dotsContainer = document.getElementById(this.dotsContainerId);
                
                if (!container || !dotsContainer || this.count === 0) return;

                // スライド生成
                const fragment = document.createDocumentFragment();
                for (let i = 1; i <= this.count; i++) {
                    const slide = document.createElement('div');
                    slide.className = `${this.slideClass} fade-slide`;
                    
                    const img = document.createElement('img');
                    img.src = `${this.folder}/${String(i).padStart(2, '0')}.jpg`;
                    img.alt = `写真 ${i}`;
                    img.loading = 'lazy';
                    
                    slide.appendChild(img);
                    fragment.appendChild(slide);
                }
                
                const arrow = container.querySelector('.prev-arrow');
                if (arrow) {
                    container.insertBefore(fragment, arrow);
                } else {
                    container.appendChild(fragment);
                }

                // ドット生成
                const dotsFragment = document.createDocumentFragment();
                for (let i = 1; i <= this.count; i++) {
                    const dot = document.createElement('button');
                    dot.className = this.dotClass;
                    dot.setAttribute('role', 'tab');
                    dot.setAttribute('aria-label', `写真 ${i}を表示`);
                    dot.onclick = () => this.goToSlide(i);
                    dotsFragment.appendChild(dot);
                }
                dotsContainer.appendChild(dotsFragment);

                // イベントリスナー
                this.setupEventListeners(container);
            }

            setupEventListeners(container) {
                // タッチイベント
                container.addEventListener('touchstart', (e) => {
                    this.touchStartX = e.touches[0].clientX;
                    this.stopAutoPlay();
                }, { passive: true });

                container.addEventListener('touchend', (e) => {
                    if (this.isTransitioning) return;
                    
                    const touchEndX = e.changedTouches[0].clientX;
                    const diff = this.touchStartX - touchEndX;
                    
                    if (Math.abs(diff) > CONFIG.swipeThreshold) {
                        this.navigate(diff > 0 ? 1 : -1);
                    }
                    this.startAutoPlay();
                }, { passive: true });

                // キーボードナビゲーション
                container.addEventListener('keydown', (e) => {
                    if (e.key === 'ArrowLeft') {
                        e.preventDefault();
                        this.navigate(-1);
                    } else if (e.key === 'ArrowRight') {
                        e.preventDefault();
                        this.navigate(1);
                    }
                });
            }

            navigate(direction) {
                if (this.isTransitioning) return;
                this.stopAutoPlay();
                this.show(this.currentIndex + direction);
            }

            goToSlide(index) {
                if (this.isTransitioning) return;
                this.stopAutoPlay();
                this.show(index);
            }

            show(n) {
                if (this.isTransitioning) return;
                this.isTransitioning = true;

                const slides = document.getElementsByClassName(this.slideClass);
                const dots = document.getElementsByClassName(this.dotClass);

                if (slides.length === 0) {
                    this.isTransitioning = false;
                    return;
                }

                if (n > slides.length) this.currentIndex = 1;
                else if (n < 1) this.currentIndex = slides.length;
                else this.currentIndex = n;

                Array.from(slides).forEach(slide => slide.style.display = 'none');
                Array.from(dots).forEach(dot => {
                    dot.classList.remove('active-dot');
                    dot.setAttribute('aria-selected', 'false');
                });

                slides[this.currentIndex - 1].style.display = 'block';
                if (dots[this.currentIndex - 1]) {
                    dots[this.currentIndex - 1].classList.add('active-dot');
                    dots[this.currentIndex - 1].setAttribute('aria-selected', 'true');
                }

                setTimeout(() => {
                    this.isTransitioning = false;
                    this.startAutoPlay();
                }, 100);
            }

            startAutoPlay() {
                this.stopAutoPlay();
                this.timer = setTimeout(() => {
                    this.show(this.currentIndex + 1);
                }, CONFIG.autoPlayInterval);
            }

            stopAutoPlay() {
                if (this.timer) {
                    clearTimeout(this.timer);
                    this.timer = null;
                }
            }
        }

        // =====================================
        // 初期化
        // =====================================
        let memoriesSlider, preshootSlider;

        async function initSliders() {
            try {
                const response = await fetch('config.json');
                const jsonConfig = await response.json();
                Object.assign(CONFIG.sliders, jsonConfig.sliders);
            } catch (error) {
                console.warn('config.jsonの読み込みに失敗しました。デフォルト設定を使用します。', error);
            }

            // 画像数の自動検出
            const [memoriesCount, preshootCount] = await Promise.all([
                detectImageCount(CONFIG.sliders.memories.folder),
                detectImageCount(CONFIG.sliders.preshoot.folder)
            ]);

            if (memoriesCount > 0) CONFIG.sliders.memories.count = memoriesCount;
            if (preshootCount > 0) CONFIG.sliders.preshoot.count = preshootCount;

            console.log(`MEMORIES: ${CONFIG.sliders.memories.count}枚, PRESHOOT: ${CONFIG.sliders.preshoot.count}枚`);

            // スライダー構築
            memoriesSlider = new Slider(
                'slideshow', 'dotsMemories', 'mySlides', 'dot',
                CONFIG.sliders.memories.folder, CONFIG.sliders.memories.count
            );
            memoriesSlider.build();

            preshootSlider = new Slider(
                'slideshowPre', 'dotsPreshoot', 'mySlidesPre', 'dotPre',
                CONFIG.sliders.preshoot.folder, CONFIG.sliders.preshoot.count
            );
            preshootSlider.build();

            // 初期表示
            setTimeout(() => {
                if (memoriesSlider) memoriesSlider.show(1);
                if (preshootSlider) preshootSlider.show(1);
                hideLoading();
            }, 100);
        }

        // グローバル関数（HTML onclick用）
        function plusSlides(n) { if (memoriesSlider) memoriesSlider.navigate(n); }
        function currentSlide(n) { if (memoriesSlider) memoriesSlider.goToSlide(n); }
        function plusSlidesPre(n) { if (preshootSlider) preshootSlider.navigate(n); }
        function currentSlidePre(n) { if (preshootSlider) preshootSlider.goToSlide(n); }

        // =====================================
        // フェードインアニメーション
        // =====================================
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        // =====================================
        // モーダル制御
        // =====================================
        function initModals() {
            const menuModal = document.getElementById('menuModal');
            const imgModal = document.getElementById('imgModal');
            const openMenuBtn = document.getElementById('openMenuModal');
            const seatingChartImg = document.getElementById('seatingChartImg');
            const expandedImg = document.getElementById('expandedImg');

            // メニューを開く
            openMenuBtn.addEventListener('click', () => {
                menuModal.classList.add('is-active');
                document.body.style.overflow = 'hidden';
            });

            // 席次表を拡大
            seatingChartImg.addEventListener('click', () => {
                imgModal.classList.add('is-active');
                expandedImg.src = seatingChartImg.src;
                expandedImg.alt = seatingChartImg.alt;
                document.body.style.overflow = 'hidden';
            });

            // 閉じるボタン
            document.querySelectorAll('.modal .close-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('.modal').classList.remove('is-active');
                    document.body.style.overflow = '';
                });
            });

            // 背景クリックで閉じる
            [menuModal, imgModal].forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('is-active');
                        document.body.style.overflow = '';
                    }
                });
            });

            // メニューリンククリック
            document.querySelectorAll('#menuModal a').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    menuModal.classList.remove('is-active');
                    document.body.style.overflow = '';
                    
                    const targetId = link.getAttribute('href');
                    const targetElement = document.querySelector(targetId);

                    if (targetElement) {
                        const offsetTop = targetElement.offsetTop - 20;
                        window.scrollTo({
                            top: offsetTop,
                            behavior: 'smooth'
                        });
                    }
                });
            });

            // Escキーで閉じる
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    menuModal.classList.remove('is-active');
                    imgModal.classList.remove('is-active');
                    document.body.style.overflow = '';
                }
            });
        }

        // =====================================
        // ローディング制御
        // =====================================
        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            overlay.style.opacity = '0';
            setTimeout(() => {
                overlay.style.display = 'none';
            }, 300);
        }

        // =====================================
        // 初期化実行
        // =====================================
        document.addEventListener('DOMContentLoaded', () => {
            // フェードイン監視
            document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));
            
            // モーダル初期化
            initModals();
            
            // スライダー初期化
            initSliders();
        });
    </script>
</body>
</html>