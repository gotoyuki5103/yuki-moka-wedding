<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wedding Profile Book | Yuki & Moka</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Shippori+Mincho:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="menu-btn" id="openMenuModal">
        <span>&equiv;</span>
    </div>

    <header class="hero container fade-in" id="top">
        <img src="images/hero.jpg" alt="Wedding Couple" class="hero-img">
        
        <h1 class="hero-title">Yuki & Moka</h1>
        <p class="hero-date">2026.04.11 | Hotel Chinzanso Tokyo</p>
    </header>

    <section class="container fade-in" id="greeting">
        <h2 class="section-title">Greeting</h2>
        <div class="greeting-text">
            <p>本日はご多用の中<br>私たちの結婚式にご参列いただき<br>誠にありがとうございます。</p>
            <p>皆様に支えられ<br>今日という日を迎えることができました。</p>
            <p>ささやかながら<br>感謝の気持ちを込めて<br>プロフィールブックを作成しました。</p>
            <p>どうぞごゆっくりお楽しみください。</p>
        </div>
    </section>

    <section class="container fade-in" id="profile">
        <h2 class="section-title">Profile</h2>
        
        <div class="profile-card">
            <img src="images/profile/yuki.jpg" alt="Groom" class="profile-img">
            <h3 class="profile-name">Yuki Goto</h3> 
            <p class="profile-desc">
                1998年生まれ、岡山県出身。<br>
                趣味は温泉に入ったり、ゆっくりすること。<br>
                休日はお家でだらだらと過ごしています。<br>
                一言：今日は最高の1日にしましょう！
            </p>
        </div>

        <div class="profile-card">
            <img src="images/profile/moka.jpg" alt="Bride" class="profile-img">
            <h3 class="profile-name">Moka Suzuki</h3>
            <p class="profile-desc">
                1999年生まれ、東京都出身。<br>
                趣味はライブに行くこと。<br>
                特技は新しいことに挑戦できること。<br>
                一言：たくさん写真を撮ってくださいね♪
            </p>
        </div>
    </section>
    
    <section class="container fade-in" id="story">
        <h2 class="section-title">Our Story</h2>

        <div class="story-item">
            <div class="story-img-box">
                <img src="images/story/01.jpg" alt="Story Photo 1">
            </div>
            <div class="story-content">
                <h4>2022.05.20 | First Date</h4>
                <p>初めて二人でキャンプに行った時の写真です。雨予報でしたが、奇跡的に晴れて最高の星空を見ることができました。ここから二人の関係が始まりました。</p>
            </div>
        </div>

        <div class="story-item">
            <div class="story-img-box">
                <img src="images/story/02.jpg" alt="Story Photo 2">
            </div>
            <div class="story-content">
                <h4>2023.11.15 | Proposal</h4>
                <p>モカの誕生日サプライズで旅行先の海辺でプロポーズしました。緊張しすぎて何を言ったか覚えていませんが、指輪を渡した瞬間、泣きながら「はい」と言ってくれた時は感動しました。</p>
            </div>
        </div>

        <div class="story-item">
            <div class="story-img-box">
                <img src="images/story/03.jpg" alt="Story Photo 3">
            </div>
            <div class="story-content">
                <h4>2024.03.01 | Together</h4>
                <p>二人で暮らし始めた記念に撮った一枚。家具を選ぶのは大変でしたが、二人だけの空間ができて毎日が楽しくなりました。これからもたくさん笑い合って過ごしたいです。</p>
            </div>
        </div>
    </section>

    <section class="container fade-in" id="preshoot">
        <h2 class="section-title">PRESHOOT</h2>
        
        <div class="slideshow-container" id="slideshowPre">
            <!-- スライドはJSで動的に生成されます -->
            <a class="prev-arrow" onclick="plusSlidesPre(-1)">&#10094;</a>
            <a class="next-arrow" onclick="plusSlidesPre(1)">&#10095;</a>
        </div>
        <br>
        <div class="dots-container" id="dotsPreshoot" style="text-align:center">
            <!-- ドットはJSで動的に生成されます -->
        </div>
    </section>

    <section class="container fade-in" id="memories">
        <h2 class="section-title">MEMORIES</h2>
        
        <div class="slideshow-container" id="slideshow">
            <!-- スライドはJSで動的に生成されます -->
            <a class="prev-arrow" onclick="plusSlides(-1)">&#10094;</a>
            <a class="next-arrow" onclick="plusSlides(1)">&#10095;</a>
        </div>
        <br>
        <div class="dots-container" id="dotsMemories" style="text-align:center">
            <!-- ドットはJSで動的に生成されます -->
        </div>
        
    </section>

    <section class="container fade-in" id="seating-chart">
        <h2 class="section-title">Seating Chart</h2>
        <div class="seating-chart-area">
            <img src="https://via.placeholder.com/800x600?text=Seating+Chart+Example" alt="Seating Chart" id="seatingChartImg">
            <p>※画像をタップすると拡大表示されます。</p>
        </div>
    </section>
    
    <section class="container fade-in" id="share-photos">
        <h2 class="section-title">Share Photos</h2>
        <div class="share-text">
            <p>本日の思い出の写真を<br>ぜひここからシェアしてください。<br>グループごとにアルバムを用意しました。</p>
        </div>
        
        <div class="share-buttons">
            <a href="https://photos.app.goo.gl/xxxxxxxxxxxx" target="_blank" class="share-btn">
                <span>For Friends</span>
                <span class="jp-label">友人・同僚の方はこちら</span>
            </a>

            <a href="https://photos.app.goo.gl/yyyyyyyyyyyy" target="_blank" class="share-btn">
                <span>For Family</span>
                <span class="jp-label">親族の方はこちら</span>
            </a>

            <a href="https://photos.app.goo.gl/zzzzzzzzzzzz" target="_blank" class="share-btn">
                <span>All Guests</span>
                <span class="jp-label">その他の方はこちら</span>
            </a>
        </div>
    </section>

    <footer>
        <p>Thank you for coming today.</p>
        <p>Yuki & Moka</p>
    </footer>

    <div id="menuModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <nav>
                <ul class="menu-list">
                    <li><a href="#top">TOP<span class="jp-nav">トップ</span></a></li>
                    <li><a href="#greeting">GREETING<span class="jp-nav">ごあいさつ</span></a></li>
                    <li><a href="#profile">PROFILE<span class="jp-nav">プロフィール</span></a></li>
                    <li><a href="#story">OUR STORY<span class="jp-nav">二人の物語</span></a></li>
                    <li><a href="#preshoot">PRESHOOT<span class="jp-nav">前撮り</span></a></li>
                    <li><a href="#memories">MEMORIES<span class="jp-nav">思い出の写真</span></a></li>
                    <li><a href="#seating-chart">SEATING CHART<span class="jp-nav">席次表</span></a></li>
                    <li><a href="#share-photos">SHARE PHOTOS<span class="jp-nav">写真の共有</span></a></li>
                </ul>
            </nav>
        </div>
    </div>

    <div id="imgModal" class="modal">
        <span class="close-btn">&times;</span>
        <div class="modal-content" id="imgModalContent">
            <img class="modal-img" id="expandedImg">
        </div>
    </div>


    <script>
        // ==================================
        // JavaScript (スライドショー、スクロールアニメーション & モーダル)
        // ==================================

        // --- 0. config.json の読み込みと動的スライド生成、画像数の自動検出 ---

        /**
         * 指定されたフォルダ内の連番画像ファイル（01.jpg, 02.jpg...）の数を自動検出する
         * @param {string} folderPath - 画像フォルダのパス (例: 'images/memories')
         * @param {number} maxCount - 検索する最大の画像数
         * @returns {Promise<number>} 見つかった画像ファイルの数
         */
        async function detectImageCount(folderPath, maxCount = 50) {
            let count = 0;
            for (let i = 1; i <= maxCount; i++) {
                const fileName = `${String(i).padStart(2, '0')}.jpg`;
                const url = `${folderPath}/${fileName}`;

                try {
                    // HEADリクエストでコンテンツを取得せずに存在チェック
                    const response = await fetch(url, { method: 'HEAD' });
                    
                    // HTTPステータス200-299の範囲が成功
                    if (response.ok) {
                        count++;
                    } else {
                        // 404 Not Found など、ファイルが存在しない場合はループを終了
                        break;
                    }
                } catch (error) {
                    // ネットワークエラーなどが発生した場合も終了
                    console.error(`Error checking image: ${url}`, error);
                    break;
                }
            }
            return count;
        }


        async function initDynamicSliders() {
            let config = {
                sliders: {
                    memories: { folder: 'images/memories', count: 5 }, // デフォルト値
                    preshoot: { folder: 'images/preshoot', count: 5 }
                }
            };

            try {
                // config.json の読み込み（フォルダパスの取得のため）
                const response = await fetch('config.json');
                const jsonConfig = await response.json();
                
                // フォルダパスをconfigから取得（countは自動検出で上書きされる）
                config = jsonConfig;
            } catch (error) {
                console.warn('config.json の読み込みに失敗しました。デフォルトのパスを使用します。', error);
                // エラー時もconfigのデフォルト値を使用し、処理を続行
            }

            // --- 画像数の自動検出 ---
            
            // MEMORIES
            const memoriesCount = await detectImageCount(config.sliders.memories.folder);
            if (memoriesCount > 0) {
                config.sliders.memories.count = memoriesCount;
            }
            console.log(`MEMORIES images detected: ${config.sliders.memories.count}`);
            
            // PRESHOOT
            const preshootCount = await detectImageCount(config.sliders.preshoot.folder);
            if (preshootCount > 0) {
                config.sliders.preshoot.count = preshootCount;
            }
            console.log(`PRESHOOT images detected: ${config.sliders.preshoot.count}`);
        
            
            // --- スライダーの構築 ---
            
            // MEMORIES セクション
            buildSlider('slideshow', 'dotsMemories', 'mySlides', 'dot', config.sliders.memories.folder, config.sliders.memories.count);
            
            // PRESHOOT セクション
            buildSlider('slideshowPre', 'dotsPreshoot', 'mySlidesPre', 'dotPre', config.sliders.preshoot.folder, config.sliders.preshoot.count);
        
            // 初期表示
            slideIndex = 1;
            preSlideIndex = 1;
            // DOM構築後に最初のスライドを確実に表示するため、短い遅延で呼び出す
            setTimeout(() => {
                if (config.sliders.memories.count > 0 && typeof showSlides === 'function') showSlides(slideIndex);
                if (config.sliders.preshoot.count > 0 && typeof showSlidesPre === 'function') showSlidesPre(preSlideIndex);
            }, 50);
        }

        // スライドとドットを動的に生成する関数
        function buildSlider(containerId, dotsContainerId, slideClass, dotClass, folder, count) {
            const container = document.getElementById(containerId);
            const dotsContainer = document.getElementById(dotsContainerId);
            
            if (!container || !dotsContainer || count === 0) return;

            // スライド要素を生成
            for (let i = 1; i <= count; i++) {
                const slide = document.createElement('div');
                slide.className = `${slideClass} fade-slide`;
                const img = document.createElement('img');
                img.src = `${folder}/${String(i).padStart(2, '0')}.jpg`;
                img.alt = `Photo ${i}`;
                slide.appendChild(img);
                // 矢印ボタンの手前に挿入（矢印ボタンがcontainerの最後にあると想定）
                const arrow = container.querySelector('.prev-arrow');
                if (arrow) {
                    container.insertBefore(slide, arrow);
                } else {
                    container.appendChild(slide); // 矢印がない場合は最後に追加
                }
            }

            // ドット要素を生成
            for (let i = 1; i <= count; i++) {
                const dot = document.createElement('span');
                dot.className = dotClass;
                dot.onclick = () => {
                    if (slideClass === 'mySlides') currentSlide(i);
                    else if (slideClass === 'mySlidesPre') currentSlidePre(i);
                };
                dotsContainer.appendChild(dot);
            }
        }

        // ページ読み込み後に実行
        document.addEventListener('DOMContentLoaded', initDynamicSliders);
        
        // --- 1. Slideshow (MEMORIES) ---
        let slideIndex = 1; 
        let slideTimer;
        let startX = 0; 

        function plusSlides(n) {
            clearTimeout(slideTimer);
            showSlides(slideIndex += n);
        }

        function currentSlide(n) {
            clearTimeout(slideTimer);
            showSlides(slideIndex = n);
        }

        function showSlides(n) {
            let i;
            const slides = document.getElementsByClassName("mySlides");
            const dots = document.getElementsByClassName("dot");

            if (slides.length === 0) return; // スライドがない場合は処理を中断

            if (n > slides.length) {slideIndex = 1}    
            if (n < 1) {slideIndex = slides.length}
            
            for (i = 0; i < slides.length; i++) {
                slides[i].style.display = "none";  
                if (dots[i]) dots[i].className = dots[i].className.replace(" active-dot", "");
            }
            
            slides[slideIndex-1].style.display = "block";  
            if (dots[slideIndex-1]) dots[slideIndex-1].className += " active-dot";
            
            clearTimeout(slideTimer);
            slideTimer = setTimeout(function() {
                showSlides(slideIndex += 1);
            }, 4000); 
        }

        // スワイプ操作 (MEMORIES)
        // DOM構築後の初期化のためsetTimeoutで囲う
        setTimeout(() => {
            const slideshowContainer = document.getElementById('slideshow');
            if (slideshowContainer) {
                slideshowContainer.addEventListener('touchstart', function(event) {
                    startX = event.touches[0].clientX;
                    clearTimeout(slideTimer); 
                });

                slideshowContainer.addEventListener('touchend', function(event) {
                    const endX = event.changedTouches[0].clientX;
                    const threshold = 50; 
                    
                    if (startX - endX > threshold) {
                        plusSlides(1); // 次のスライド
                    } else if (endX - startX > threshold) {
                        plusSlides(-1); // 前のスライド
                    }
                    
                    slideTimer = setTimeout(function() {
                        showSlides(slideIndex += 1);
                    }, 4000);
                });
            }
        }, 100);

        // --- 2. フェードインアニメーション（既存） ---
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { 
            threshold: 0.1 
        });

        document.querySelectorAll('.fade-in').forEach(el => {
            observer.observe(el);
        });

        // --- 3. モーダル（ポップアップ）制御（既存） ---
        
        const menuModal = document.getElementById('menuModal');
        const imgModal = document.getElementById('imgModal');
        const openMenuBtn = document.getElementById('openMenuModal');
        const seatingChartImg = document.getElementById('seatingChartImg');
        const expandedImg = document.getElementById('expandedImg');
        const menuLinks = document.querySelectorAll('#menuModal a');

        openMenuBtn.onclick = function() {
            menuModal.classList.add('is-active');
        }

        seatingChartImg.onclick = function() {
            imgModal.classList.add('is-active');
            expandedImg.src = this.src;
            document.querySelector('#imgModal .close-btn').style.color = '#fff';
        }

        document.querySelectorAll('.modal .close-btn').forEach(btn => {
            btn.onclick = function() {
                this.closest('.modal').classList.remove('is-active');
            }
        });

        window.onclick = function(event) {
            if (event.target == menuModal) {
                menuModal.classList.remove('is-active');
            }
            if (event.target == imgModal) {
                imgModal.classList.remove('is-active');
            }
        }

        menuLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                menuModal.classList.remove('is-active'); 
                
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);

                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop,
                        behavior: 'smooth'
                    });
                }
            });
        });

        // --- 4. 前撮りギャラリー用スライド制御 (PRESHOOT) ---
        let preSlideIndex = 1;
        let preSlideTimer;
        let preStartX = 0;

        function plusSlidesPre(n) {
            clearTimeout(preSlideTimer);
            showSlidesPre(preSlideIndex += n);
        }

        function currentSlidePre(n) {
            clearTimeout(preSlideTimer);
            showSlidesPre(preSlideIndex = n);
        }

        function showSlidesPre(n) {
            let i;
            const slides = document.getElementsByClassName("mySlidesPre");
            const dots = document.getElementsByClassName("dotPre");

            if (slides.length === 0) return;

            if (n > slides.length) { preSlideIndex = 1 }
            if (n < 1) { preSlideIndex = slides.length }

            for (i = 0; i < slides.length; i++) {
                slides[i].style.display = "none";
                if (dots[i]) dots[i].className = dots[i].className.replace(" active-dot", "");
            }

            slides[preSlideIndex-1].style.display = "block";
            if (dots[preSlideIndex-1]) dots[preSlideIndex-1].className += " active-dot";

            clearTimeout(preSlideTimer);
            preSlideTimer = setTimeout(function() {
                showSlidesPre(preSlideIndex += 1);
            }, 4000);
        }

        // タッチ操作（前撮り）
        // DOM構築後の初期化のためsetTimeoutで囲う
        setTimeout(() => {
            const slideshowPreContainer = document.getElementById('slideshowPre');
            if (slideshowPreContainer) {
                slideshowPreContainer.addEventListener('touchstart', function(event) {
                    preStartX = event.touches[0].clientX;
                    clearTimeout(preSlideTimer);
                });

                slideshowPreContainer.addEventListener('touchend', function(event) {
                    const endX = event.changedTouches[0].clientX;
                    const threshold = 50;
                    if (preStartX - endX > threshold) {
                        plusSlidesPre(1);
                    } else if (endX - preStartX > threshold) {
                        plusSlidesPre(-1);
                    }

                    preSlideTimer = setTimeout(function() {
                        showSlidesPre(preSlideIndex += 1);
                    }, 4000);
                });
            }
        }, 100);

    </script>
</body>
</html>
